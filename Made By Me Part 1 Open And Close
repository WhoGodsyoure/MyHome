--!nocheck
-- Simple GUI Library (Enhanced 2025-2026 style) by Grok
-- Tombol Close → Toggle Minimize / Restore (Open/Close)

local Library = {}

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local function create(class, props)
    local obj = Instance.new(class)
    for k, v in pairs(props or {}) do
        if k ~= "Parent" then
            pcall(function() obj[k] = v end)
        end
    end
    if props and props.Parent then
        obj.Parent = props.Parent
    end
    return obj
end

local function dragify(frame)
    local dragging, dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

function Library:CreateWindow(options)
    options = options or {}
    local title = options.Title or "UI Library"

    local ScreenGui = create("ScreenGui", {
        Name = "SimpleUILib",
        Parent = game.CoreGui,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })

    local MainFrame = create("Frame", {
        Name = "Main",
        Parent = ScreenGui,
        BackgroundColor3 = Color3.fromRGB(25, 25, 30),
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -160, 0.5, -170),
        Size = UDim2.new(0, 320, 0, 340),
        ClipsDescendants = true,
        Visible = true
    })

    -- Title bar
    local TitleBar = create("Frame", {
        Name = "TitleBar",
        Parent = MainFrame,
        BackgroundColor3 = Color3.fromRGB(35, 35, 45),
        Size = UDim2.new(1, 0, 0, 36),
        BorderSizePixel = 0
    })

    local TitleLabel = create("TextLabel", {
        Name = "Title",
        Parent = TitleBar,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -50, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        Font = Enum.Font.GothamBold,
        Text = title,
        TextColor3 = Color3.fromRGB(220, 220, 230),
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    local ToggleBtn = create("TextButton", {
        Name = "Toggle",
        Parent = TitleBar,
        BackgroundColor3 = Color3.fromRGB(60, 140, 80),
        Size = UDim2.new(0, 28, 0, 28),
        Position = UDim2.new(1, -34, 0, 4),
        Font = Enum.Font.GothamBold,
        Text = "–",  -- minimize
        TextColor3 = Color3.new(1,1,1),
        TextSize = 18
    })

    local minimized = false
    local normalSize = UDim2.new(0, 320, 0, 340)

    ToggleBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        if minimized then
            -- Minimize
            MainFrame.Size = UDim2.new(0, 320, 0, 36)
            ToggleBtn.Text = "□"  -- restore
            ToggleBtn.BackgroundColor3 = Color3.fromRGB(80, 160, 100)
        else
            -- Restore
            MainFrame.Size = normalSize
            ToggleBtn.Text = "–"
            ToggleBtn.BackgroundColor3 = Color3.fromRGB(60, 140, 80)
        end
    end)

    -- Content area
    local ScrollingFrame = create("ScrollingFrame", {
        Name = "Content",
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 36),
        Size = UDim2.new(1, 0, 1, -36),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 5,
        ScrollBarImageColor3 = Color3.fromRGB(80, 80, 100),
        ScrollingDirection = Enum.ScrollingDirection.Y
    })

    local UIListLayout = create("UIListLayout", {
        Parent = ScrollingFrame,
        Padding = UDim.new(0, 8),
        SortOrder = Enum.SortOrder.LayoutOrder,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center
    })

    UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 20)
    end)

    dragify(MainFrame)

    local Window = {}

    function Window:Section(name)
        local SectionFrame = create("Frame", {
            Name = name,
            Parent = ScrollingFrame,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -24, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y
        })

        create("TextLabel", {
            Name = "SectionTitle",
            Parent = SectionFrame,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 28),
            Font = Enum.Font.GothamSemibold,
            Text = "  " .. name,
            TextColor3 = Color3.fromRGB(150, 210, 255),
            TextSize = 15,
            TextXAlignment = Enum.TextXAlignment.Left
        })

        local List = create("UIListLayout", {
            Parent = SectionFrame,
            Padding = UDim.new(0, 6),
            SortOrder = Enum.SortOrder.LayoutOrder,
            FillDirection = Enum.FillDirection.Vertical,
            HorizontalAlignment = Enum.HorizontalAlignment.Center
        })

        List:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            SectionFrame.Size = UDim2.new(1, -24, 0, List.AbsoluteContentSize.Y + 8)
        end)

        local Section = {}

        function Section:Button(text, callback)
            local btn = create("TextButton", {
                Parent = SectionFrame,
                BackgroundColor3 = Color3.fromRGB(50, 50, 65),
                Size = UDim2.new(1, -12, 0, 34),
                Font = Enum.Font.GothamSemibold,
                Text = text,
                TextColor3 = Color3.new(1,1,1),
                TextSize = 14,
                AutoButtonColor = false
            })

            create("UICorner", {Parent = btn, CornerRadius = UDim.new(0,6)})
            create("UIStroke", {Parent = btn, Color = Color3.fromRGB(70,70,90), Thickness = 1})

            btn.MouseEnter:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70,70,90)}):Play()
            end)
            btn.MouseLeave:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50,50,65)}):Play()
            end)

            btn.MouseButton1Click:Connect(callback or function() end)
            return btn
        end

        function Section:Label(text)
            local lbl = create("TextLabel", {
                Parent = SectionFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, -12, 0, 22),
                Font = Enum.Font.Gotham,
                Text = text,
                TextColor3 = Color3.fromRGB(190,190,210),
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left,
                RichText = true
            })
            return lbl
        end

        function Section:Toggle(label, default, callback)
            default = default or false
            callback = callback or function() end

            local frame = create("Frame", {
                Parent = SectionFrame,
                BackgroundColor3 = Color3.fromRGB(45,45,55),
                Size = UDim2.new(1, -12, 0, 34)
            })
            create("UICorner", {Parent = frame, CornerRadius = UDim.new(0,6)})

            create("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Size = UDim2.new(0.65, 0, 1, 0),
                Position = UDim2.new(0,12,0,0),
                Font = Enum.Font.GothamSemibold,
                Text = label,
                TextColor3 = Color3.new(1,1,1),
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local indicator = create("Frame", {
                Parent = frame,
                BackgroundColor3 = default and Color3.fromRGB(60,200,100) or Color3.fromRGB(90,90,100),
                Size = UDim2.new(0, 42, 0, 22),
                Position = UDim2.new(1, -54, 0.5, -11),
                BorderSizePixel = 0
            })
            create("UICorner", {Parent = indicator, CornerRadius = UDim.new(0,11)})

            local state = default

            local function update()
                TweenService:Create(indicator, TweenInfo.new(0.25, Enum.EasingStyle.Quint), {
                    BackgroundColor3 = state and Color3.fromRGB(60,200,100) or Color3.fromRGB(90,90,100),
                    Position = state and UDim2.new(1, -54, 0.5, -11) or UDim2.new(1, -96, 0.5, -11)
                }):Play()
            end

            frame.InputBegan:Connect(function(inp)
                if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then
                    state = not state
                    update()
                    task.spawn(callback, state)
                end
            end)

            update()

            return {
                Toggle = function(v)
                    state = v
                    update()
                    task.spawn(callback, v)
                end,
                Value = function() return state end
            }
        end

        function Section:Slider(label, min, max, default, step, callback)
            min = min or 0
            max = max or 100
            step = step or 1
            default = math.clamp(default or min, min, max)
            callback = callback or function() end

            local frame = create("Frame", {
                Parent = SectionFrame,
                BackgroundColor3 = Color3.fromRGB(45,45,55),
                Size = UDim2.new(1, -12, 0, 52)
            })
            create("UICorner", {Parent = frame, CornerRadius = UDim.new(0,6)})

            create("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, -80, 0, 24),
                Position = UDim2.new(0,12,0,6),
                Font = Enum.Font.GothamSemibold,
                Text = label,
                TextColor3 = Color3.new(1,1,1),
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local valueLabel = create("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Size = UDim2.new(0,70,0,24),
                Position = UDim2.new(1,-78,0,6),
                Font = Enum.Font.Gotham,
                Text = tostring(default),
                TextColor3 = Color3.fromRGB(180,240,180),
                TextSize = 14
            })

            local bar = create("Frame", {
                Parent = frame,
                BackgroundColor3 = Color3.fromRGB(60,60,75),
                Size = UDim2.new(1,-24,0,8),
                Position = UDim2.new(0,12,0,34),
                BorderSizePixel = 0
            })
            create("UICorner", {Parent = bar, CornerRadius = UDim.new(0,4)})

            local fill = create("Frame", {
                Parent = bar,
                BackgroundColor3 = Color3.fromRGB(90,180,255),
                Size = UDim2.new(0.5,0,1,0),
                BorderSizePixel = 0
            })
            create("UICorner", {Parent = fill, CornerRadius = UDim.new(0,4)})

            local dragging = false

            local function updateSlider(posX)
                local rel = math.clamp((posX - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
                local value = min + (max - min) * rel
                value = math.floor((value - min) / step + 0.5) * step + min
                value = math.clamp(value, min, max)

                fill.Size = UDim2.new(rel, 0, 1, 0)
                valueLabel.Text = tostring(value)
                task.spawn(callback, value)
            end

            bar.InputBegan:Connect(function(inp)
                if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    updateSlider(inp.Position.X)
                end
            end)

            UserInputService.InputEnded:Connect(function(inp)
                if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then
                    dragging = false
                end
            end)

            UserInputService.InputChanged:Connect(function(inp)
                if dragging and (inp.UserInputType == Enum.UserInputType.MouseMovement or inp.UserInputType == Enum.UserInputType.Touch) then
                    updateSlider(inp.Position.X)
                end
            end)

            local initRel = (default - min) / (max - min)
            fill.Size = UDim2.new(initRel, 0, 1, 0)
            valueLabel.Text = tostring(default)

            return {
                Set = function(v)
                    v = math.clamp(v, min, max)
                    local rel = (v - min) / (max - min)
                    fill.Size = UDim2.new(rel, 0, 1, 0)
                    valueLabel.Text = tostring(v)
                    task.spawn(callback, v)
                end
            }
        end

        function Section:Dropdown(label, options, default, callback)
            options = options or {}
            default = default or (options[1] or "...")
            callback = callback or function() end

            local frame = create("Frame", {
                Parent = SectionFrame,
                BackgroundColor3 = Color3.fromRGB(45,45,55),
                Size = UDim2.new(1, -12, 0, 34)
            })
            create("UICorner", {Parent = frame, CornerRadius = UDim.new(0,6)})

            create("TextLabel", {
                Parent = frame,
                BackgroundTransparency = 1,
                Size = UDim2.new(0.58, 0, 1, 0),
                Position = UDim2.new(0,12,0,0),
                Font = Enum.Font.GothamSemibold,
                Text = label,
                TextColor3 = Color3.new(1,1,1),
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextTruncate = Enum.TextTruncate.AtEnd
            })

            local selected = create("TextLabel", {
                Parent = frame,
                BackgroundColor3 = Color3.fromRGB(35,35,45),
                Size = UDim2.new(0.38, 0, 0.82, 0),
                Position = UDim2.new(0.6, 0, 0.09, 0),
                Font = Enum.Font.Gotham,
                Text = tostring(default),
                TextColor3 = Color3.fromRGB(200,220,255),
                TextSize = 13,
                TextTruncate = Enum.TextTruncate.AtEnd
            })
            create("UICorner", {Parent = selected, CornerRadius = UDim.new(0,5)})
            create("UIStroke", {Parent = selected, Color = Color3.fromRGB(70,70,90), Thickness = 1})

            local arrow = create("TextLabel", {
                Parent = selected,
                BackgroundTransparency = 1,
                Size = UDim2.new(0,20,1,0),
                Position = UDim2.new(1,-22,0,0),
                Font = Enum.Font.GothamBold,
                Text = "▼",
                TextColor3 = Color3.fromRGB(160,160,180),
                TextSize = 14
            })

            local isOpen = false
            local dropdownList = nil
            local connections = {}

            local function closeDropdown()
                if dropdownList then
                    dropdownList:Destroy()
                    dropdownList = nil
                end
                isOpen = false
                arrow.Text = "▼"
                for _, conn in ipairs(connections) do
                    conn:Disconnect()
                end
                table.clear(connections)
            end

            local function openDropdown()
                if isOpen then return end
                isOpen = true
                arrow.Text = "▲"

                local absPos = selected.AbsolutePosition
                local absSize = selected.AbsoluteSize
                local parentAbsPos = ScrollingFrame.AbsolutePosition

                local relX = absPos.X - parentAbsPos.X
                local relY = absPos.Y - parentAbsPos.Y + absSize.Y + 4

                dropdownList = create("ScrollingFrame", {
                    Parent = ScrollingFrame,
                    BackgroundColor3 = Color3.fromRGB(30,30,40),
                    BorderSizePixel = 0,
                    Size = UDim2.new(0, absSize.X, 0, math.min(#options * 32 + 8, 200)),
                    Position = UDim2.new(0, relX, 0, relY),
                    CanvasSize = UDim2.new(0,0,0,0),
                    ScrollBarThickness = 4,
                    ScrollBarImageColor3 = Color3.fromRGB(90,90,120),
                    ZIndex = 20,
                    ClipsDescendants = true
                })
                create("UICorner", {Parent = dropdownList, CornerRadius = UDim.new(0,6)})
                create("UIStroke", {Parent = dropdownList, Color = Color3.fromRGB(80,80,110), Thickness = 1})

                local listLayout = create("UIListLayout", {
                    Parent = dropdownList,
                    Padding = UDim.new(0,2),
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    FillDirection = Enum.FillDirection.Vertical
                })

                local function updateCanvas()
                    dropdownList.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 6)
                end

                listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)

                for _, opt in ipairs(options) do
                    local btn = create("TextButton", {
                        Parent = dropdownList,
                        BackgroundTransparency = 1,
                        Size = UDim2.new(1, -8, 0, 30),
                        Font = Enum.Font.Gotham,
                        Text = "  " .. tostring(opt),
                        TextColor3 = Color3.new(1,1,1),
                        TextSize = 13,
                        TextXAlignment = Enum.TextXAlignment.Left
                    })

                    btn.MouseEnter:Connect(function()
                        btn.BackgroundTransparency = 0.7
                        btn.BackgroundColor3 = Color3.fromRGB(70,70,100)
                    end)
                    btn.MouseLeave:Connect(function()
                        btn.BackgroundTransparency = 1
                    end)

                    btn.MouseButton1Click:Connect(function()
                        selected.Text = tostring(opt)
                        closeDropdown()
                        task.spawn(callback, opt)
                    end)
                end

                updateCanvas()

                table.insert(connections, UserInputService.InputBegan:Connect(function(input, gameProcessed)
                    if gameProcessed then return end
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        local mousePos = input.Position
                        local listAbsPos = dropdownList.AbsolutePosition
                        local listAbsSize = dropdownList.AbsoluteSize

                        if not (mousePos.X >= listAbsPos.X and mousePos.X <= listAbsPos.X + listAbsSize.X and
                                mousePos.Y >= listAbsPos.Y and mousePos.Y <= listAbsPos.Y + listAbsSize.Y) then
                            closeDropdown()
                        end
                    end
                end))
            end

            frame.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    if isOpen then
                        closeDropdown()
                    else
                        openDropdown()
                    end
                end
            end)

            return {
                Set = function(value)
                    if table.find(options, value) then
                        selected.Text = tostring(value)
                        task.spawn(callback, value)
                    end
                end,
                Get = function()
                    return selected.Text
                end
            }
        end

        return Section
    end

    return Window
end

return Library
