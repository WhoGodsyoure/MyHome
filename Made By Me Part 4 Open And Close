local Library = {}

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local function createInstance(class, properties)
	local inst = Instance.new(class)
	for prop, value in pairs(properties or {}) do
		if prop ~= "Parent" then
			inst[prop] = value
		end
	end
	if properties and properties.Parent then
		inst.Parent = properties.Parent
	end
	return inst
end

function Library:CreateWindow(options)
	options = options or {}
	local titleText = options.Title or "Window"
	
	local ScreenGui = createInstance("ScreenGui", {
		Name = "ArchiveXNovaGUI",
		ResetOnSpawn = false,
		Parent = game.CoreGui
	})
	
	local MainFrame = createInstance("Frame", {
		Name = "Main",
		Size = UDim2.new(0, 200, 0, 200),
		Position = UDim2.new(0.5, -100, 0.5, -100),
		BackgroundColor3 = Color3.fromRGB(30, 30, 35),
		BorderSizePixel = 0,
		ClipsDescendants = true,
		Parent = ScreenGui
	})
	
	local Corner = createInstance("UICorner", {
		CornerRadius = UDim.new(0, 8),
		Parent = MainFrame
	})
	
	local Stroke = createInstance("UIStroke", {
		Color = Color3.fromRGB(60, 160, 255),
		Transparency = 0.6,
		ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
		Parent = MainFrame
	})
	
	-- Title Bar
	local TitleBar = createInstance("Frame", {
		Name = "TitleBar",
		Size = UDim2.new(1, 0, 0, 32),
		BackgroundColor3 = Color3.fromRGB(40, 40, 48),
		BorderSizePixel = 0,
		Parent = MainFrame
	})
	
	createInstance("UICorner", {CornerRadius = UDim.new(0, 8), Parent = TitleBar})
	
	local TitleLabel = createInstance("TextLabel", {
		Size = UDim2.new(1, -70, 1, 0),
		Position = UDim2.new(0, 12, 0, 0),
		BackgroundTransparency = 1,
		Text = titleText,
		TextColor3 = Color3.fromRGB(220, 220, 230),
		TextSize = 15,
		Font = Enum.Font.GothamSemibold,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = TitleBar
	})
	
	local MinimizeButton = createInstance("TextButton", {
		Name = "Minimize",
		Size = UDim2.new(0, 28, 0, 28),
		Position = UDim2.new(1, -36, 0, 2),
		BackgroundColor3 = Color3.fromRGB(60, 180, 60),
		Text = "−",
		TextColor3 = Color3.new(1,1,1),
		TextSize = 18,
		Font = Enum.Font.GothamBold,
		Parent = TitleBar
	})
	
	createInstance("UICorner", {CornerRadius = UDim.new(0, 6), Parent = MinimizeButton})
	
	-- Content Area
	local Content = createInstance("ScrollingFrame", {
		Name = "Content",
		Size = UDim2.new(1, -12, 1, -44),
		Position = UDim2.new(0, 6, 0, 38),
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		ScrollBarThickness = 4,
		ScrollBarImageColor3 = Color3.fromRGB(80, 80, 100),
		CanvasSize = UDim2.new(0, 0, 0, 0),
		AutomaticCanvasSize = Enum.AutomaticSize.Y,
		Parent = MainFrame
	})
	
	createInstance("UIPadding", {
		PaddingTop = UDim.new(0, 6),
		PaddingLeft = UDim.new(0, 4),
		PaddingRight = UDim.new(0, 8),
		PaddingBottom = UDim.new(0, 8),
		Parent = Content
	})
	
	createInstance("UIListLayout", {
		Padding = UDim.new(0, 8),
		SortOrder = Enum.SortOrder.LayoutOrder,
		Parent = Content
	})
	
	-- Dragging
	local dragging, dragInput, dragStart, startPos
	
	local function updateInput(input)
		local delta = input.Position - dragStart
		local newPos = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
		MainFrame.Position = newPos
	end
	
	TitleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = MainFrame.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	TitleBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			updateInput(input)
		end
	end)
	
	-- Minimize / Restore logic
	local minimized = false
	local normalSize = MainFrame.Size
	local normalPosition = MainFrame.Position
	
	MinimizeButton.MouseButton1Click:Connect(function()
		if minimized then
			-- Restore
			MainFrame.Size = normalSize
			MainFrame.Position = normalPosition
			Content.Visible = true
			MinimizeButton.Text = "−"
			minimized = false
		else
			-- Minimize
			normalSize = MainFrame.Size
			normalPosition = MainFrame.Position
			
			local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
			TweenService:Create(MainFrame, tweenInfo, {Size = UDim2.new(0, 200, 0, 32)}):Play()
			
			Content.Visible = false
			MinimizeButton.Text = "+"
			minimized = true
		end
	end)
	
	-- Button creator
	local window = {}
	
	function window:Button(text, callback)
		local Button = createInstance("TextButton", {
			Size = UDim2.new(1, 0, 0, 34),
			BackgroundColor3 = Color3.fromRGB(55, 55, 65),
			BorderSizePixel = 0,
			Text = text or "Button",
			TextColor3 = Color3.fromRGB(230, 230, 240),
			TextSize = 14,
			Font = Enum.Font.GothamSemibold,
			AutoButtonColor = false,
			Parent = Content
		})
		
		createInstance("UICorner", {CornerRadius = UDim.new(0, 6), Parent = Button})
		
		local hover = createInstance("UIStroke", {
			Color = Color3.fromRGB(100, 180, 255),
			Transparency = 1,
			ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
			Parent = Button
		})
		
		Button.MouseEnter:Connect(function()
			TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 70, 85)}):Play()
			TweenService:Create(hover, TweenInfo.new(0.2), {Transparency = 0.4}):Play()
		end)
		
		Button.MouseLeave:Connect(function()
			TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(55, 55, 65)}):Play()
			TweenService:Create(hover, TweenInfo.new(0.2), {Transparency = 1}):Play()
		end)
		
		Button.MouseButton1Click:Connect(function()
			if callback and type(callback) == "function" then
				callback()
			end
		end)
		
		return Button
	end
	
	return window
end

return Library
